BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%beige%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 269405958.222959
 ALGERIA                   |   1997 | 454627088.942025
 ALGERIA                   |   1996 | 451316843.151169
 ALGERIA                   |   1995 | 458972989.496597
 ALGERIA                   |   1994 | 460579875.957803
 ALGERIA                   |   1993 | 460333132.652452
 ALGERIA                   |   1992 | 463701793.232041
 ARGENTINA                 |   1998 | 270347850.805186
 ARGENTINA                 |   1997 | 469741183.506011
 ARGENTINA                 |   1996 | 468165302.561588
 ARGENTINA                 |   1995 | 459416931.940652
 ARGENTINA                 |   1994 | 460066677.230201
 ARGENTINA                 |   1993 | 463677817.922124
 ARGENTINA                 |   1992 | 452626725.777808
 BRAZIL                    |   1998 | 276316455.035055
 BRAZIL                    |   1997 | 478845687.563439
 BRAZIL                    |   1996 | 468545676.748784
 BRAZIL                    |   1995 | 472627202.101895
 BRAZIL                    |   1994 | 474315557.466773
 BRAZIL                    |   1993 | 465797702.706208
 BRAZIL                    |   1992 | 475819304.153178
 CANADA                    |   1998 | 277495228.230814
 CANADA                    |   1997 | 471348113.506888
 CANADA                    |   1996 | 464876159.284923
 CANADA                    |   1995 |  472580493.87343
 CANADA                    |   1994 | 478219262.774683
 CANADA                    |   1993 | 467264492.735491
 CANADA                    |   1992 | 477691926.758297
 CHINA                     |   1998 | 278159410.286497
 CHINA                     |   1997 | 476313439.175137
 CHINA                     |   1996 | 462600647.994088
 CHINA                     |   1995 | 467554638.409477
 CHINA                     |   1994 | 470914712.029547
 CHINA                     |   1993 | 469841537.624868
 CHINA                     |   1992 | 479824550.437579
 EGYPT                     |   1998 | 272192515.279417
 EGYPT                     |   1997 | 470545177.226392
 EGYPT                     |   1996 | 472542173.469945
 EGYPT                     |   1995 | 463428410.380907
 EGYPT                     |   1994 | 460327657.028275
 EGYPT                     |   1993 |  462926739.12348
 EGYPT                     |   1992 | 465371540.257165
 ETHIOPIA                  |   1998 | 269589202.511324
 ETHIOPIA                  |   1997 | 452624592.793914
 ETHIOPIA                  |   1996 | 451972998.188418
 ETHIOPIA                  |   1995 | 457368162.915546
 ETHIOPIA                  |   1994 | 461026355.583816
 ETHIOPIA                  |   1993 | 455652172.760987
 ETHIOPIA                  |   1992 | 463373673.903794
 FRANCE                    |   1998 | 262286224.716049
 FRANCE                    |   1997 |   459443902.5693
 FRANCE                    |   1996 | 461454414.512138
 FRANCE                    |   1995 | 447075095.935028
 FRANCE                    |   1994 | 456702848.893475
 FRANCE                    |   1993 | 457572622.961208
 FRANCE                    |   1992 | 461859990.620564
 GERMANY                   |   1998 | 276321159.696318
 GERMANY                   |   1997 | 479375457.429357
 GERMANY                   |   1996 | 478698884.622402
 GERMANY                   |   1995 | 488239672.316769
 GERMANY                   |   1994 | 483370285.751804
 GERMANY                   |   1993 |  485539553.82535
 GERMANY                   |   1992 | 484200502.708528
 INDIA                     |   1998 | 273113760.988825
 INDIA                     |   1997 | 475324365.234113
 INDIA                     |   1996 | 478165174.729643
 INDIA                     |   1995 | 472792967.801338
 INDIA                     |   1994 | 468658237.206079
 INDIA                     |   1993 | 470931368.324472
 INDIA                     |   1992 | 476345356.246948
 INDONESIA                 |   1998 | 275225672.358879
 INDONESIA                 |   1997 | 475884704.862797
 INDONESIA                 |   1996 | 475975786.293699
 INDONESIA                 |   1995 | 465547502.108274
 INDONESIA                 |   1994 | 473198204.541859
 INDONESIA                 |   1993 | 468478206.532507
 INDONESIA                 |   1992 | 462834464.349153
 IRAN                      |   1998 | 273893726.554414
 IRAN                      |   1997 | 463258212.756471
 IRAN                      |   1996 | 463739211.701908
 IRAN                      |   1995 | 460168626.459126
 IRAN                      |   1994 | 457326720.684486
 IRAN                      |   1993 | 454007146.792391
 IRAN                      |   1992 | 464034539.460802
 IRAQ                      |   1998 | 275621885.410236
 IRAQ                      |   1997 | 461323441.505761
 IRAQ                      |   1996 | 478284733.588437
 IRAQ                      |   1995 | 475381196.571257
 IRAQ                      |   1994 | 469249736.777563
 IRAQ                      |   1993 | 468444757.984231
 IRAQ                      |   1992 | 475345464.675973
 JAPAN                     |   1998 | 270522544.992933
 JAPAN                     |   1997 | 454056015.095311
 JAPAN                     |   1996 | 458057463.645985
 JAPAN                     |   1995 | 453744804.882307
 JAPAN                     |   1994 |  456835392.62006
 JAPAN                     |   1993 |  462187956.35615
 JAPAN                     |   1992 | 461314253.721862
 JORDAN                    |   1998 |  270713010.15214
 JORDAN                    |   1997 | 458733048.417226
 JORDAN                    |   1996 | 456740997.981242
 JORDAN                    |   1995 | 455595872.672876
 JORDAN                    |   1994 | 456735453.620249
 JORDAN                    |   1993 | 462294113.172892
 JORDAN                    |   1992 | 467109196.274457
 KENYA                     |   1998 | 268472660.389957
 KENYA                     |   1997 | 472159025.172339
 KENYA                     |   1996 | 465436037.886352
 KENYA                     |   1995 | 469208673.879937
 KENYA                     |   1994 | 470494817.728003
 KENYA                     |   1993 | 463074701.597372
 KENYA                     |   1992 |  475397894.26364
 MOROCCO                   |   1998 | 272891119.606271
 MOROCCO                   |   1997 | 458120844.672094
 MOROCCO                   |   1996 | 472865133.671723
 MOROCCO                   |   1995 | 468644735.996578
 MOROCCO                   |   1994 | 462776066.487184
 MOROCCO                   |   1993 |  467977282.35476
 MOROCCO                   |   1992 | 468159583.736434
 MOZAMBIQUE                |   1998 | 264942140.209975
 MOZAMBIQUE                |   1997 | 442361913.014092
 MOZAMBIQUE                |   1996 | 455633511.488473
 MOZAMBIQUE                |   1995 | 454431775.821876
 MOZAMBIQUE                |   1994 | 453413806.367914
 MOZAMBIQUE                |   1993 | 447126883.063378
 MOZAMBIQUE                |   1992 | 444794969.860805
 PERU                      |   1998 | 278433146.280052
 PERU                      |   1997 |  476726846.73927
 PERU                      |   1996 | 465119358.714074
 PERU                      |   1995 | 468644013.689598
 PERU                      |   1994 | 469176135.265469
 PERU                      |   1993 | 470743198.797293
 PERU                      |   1992 | 467718387.109669
 ROMANIA                   |   1998 | 272603924.936129
 ROMANIA                   |   1997 | 456018056.229041
 ROMANIA                   |   1996 |  465372792.02131
 ROMANIA                   |   1995 | 451504613.101511
 ROMANIA                   |   1994 | 455491210.616135
 ROMANIA                   |   1993 | 458618793.381829
 ROMANIA                   |   1992 | 456362692.810818
 RUSSIA                    |   1998 | 280492162.430248
 RUSSIA                    |   1997 | 476367002.056612
 RUSSIA                    |   1996 | 472810286.334196
 RUSSIA                    |   1995 | 477619922.871593
 RUSSIA                    |   1994 | 473127532.516258
 RUSSIA                    |   1993 | 478097317.600699
 RUSSIA                    |   1992 | 476187842.077553
 SAUDI ARABIA              |   1998 | 277305980.579912
 SAUDI ARABIA              |   1997 | 477063147.620012
 SAUDI ARABIA              |   1996 | 468393322.385462
 SAUDI ARABIA              |   1995 |  475928954.13057
 SAUDI ARABIA              |   1994 | 467524498.195954
 SAUDI ARABIA              |   1993 | 473061533.793442
 SAUDI ARABIA              |   1992 | 478374026.913754
 UNITED KINGDOM            |   1998 | 279094142.889778
 UNITED KINGDOM            |   1997 | 462384521.114416
 UNITED KINGDOM            |   1996 | 461143872.807832
 UNITED KINGDOM            |   1995 | 465407091.411507
 UNITED KINGDOM            |   1994 | 458923116.173495
 UNITED KINGDOM            |   1993 | 462160899.963542
 UNITED KINGDOM            |   1992 | 469872177.224013
 UNITED STATES             |   1998 | 274077102.787286
 UNITED STATES             |   1997 | 466135756.436915
 UNITED STATES             |   1996 | 470452296.638264
 UNITED STATES             |   1995 |  471878401.65125
 UNITED STATES             |   1994 | 470872513.430142
 UNITED STATES             |   1993 | 475342381.088078
 UNITED STATES             |   1992 | 467071808.855885
 VIETNAM                   |   1998 | 273777768.008057
 VIETNAM                   |   1997 | 468112310.216587
 VIETNAM                   |   1996 | 472937357.376055
 VIETNAM                   |   1995 | 467229491.111376
 VIETNAM                   |   1994 | 462893096.706211
 VIETNAM                   |   1993 | 468426549.084396
 VIETNAM                   |   1992 |  465099523.97527
(175 rows)

COMMIT;
COMMIT
