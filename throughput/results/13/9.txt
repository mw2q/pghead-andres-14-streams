BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%tan%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 267483947.367674
 ALGERIA                   |   1997 | 461258738.267858
 ALGERIA                   |   1996 | 457523822.535819
 ALGERIA                   |   1995 | 461615152.520681
 ALGERIA                   |   1994 |   462632198.0264
 ALGERIA                   |   1993 | 455832931.017948
 ALGERIA                   |   1992 | 460566705.960739
 ARGENTINA                 |   1998 |   277244590.7393
 ARGENTINA                 |   1997 | 472519753.225719
 ARGENTINA                 |   1996 | 464917419.889572
 ARGENTINA                 |   1995 | 466008824.583427
 ARGENTINA                 |   1994 | 469012766.688668
 ARGENTINA                 |   1993 | 463816896.194271
 ARGENTINA                 |   1992 | 473481688.474921
 BRAZIL                    |   1998 | 275603619.199347
 BRAZIL                    |   1997 | 471416291.882955
 BRAZIL                    |   1996 | 466878443.851947
 BRAZIL                    |   1995 | 473986949.601039
 BRAZIL                    |   1994 | 463813074.942514
 BRAZIL                    |   1993 |    473158733.843
 BRAZIL                    |   1992 | 470621197.661152
 CANADA                    |   1998 | 278169521.728049
 CANADA                    |   1997 | 473121361.435167
 CANADA                    |   1996 | 476843407.784916
 CANADA                    |   1995 | 477820327.170252
 CANADA                    |   1994 | 475209293.898269
 CANADA                    |   1993 | 479858186.825061
 CANADA                    |   1992 | 480480425.087584
 CHINA                     |   1998 | 271344643.879152
 CHINA                     |   1997 | 459027771.364426
 CHINA                     |   1996 | 464527955.234965
 CHINA                     |   1995 | 462689533.381105
 CHINA                     |   1994 |  462285688.92475
 CHINA                     |   1993 | 462109285.992324
 CHINA                     |   1992 | 469270782.796603
 EGYPT                     |   1998 | 278180311.940475
 EGYPT                     |   1997 | 466376100.434509
 EGYPT                     |   1996 | 468379391.431032
 EGYPT                     |   1995 | 466663745.823749
 EGYPT                     |   1994 | 461095338.724649
 EGYPT                     |   1993 | 467917676.401477
 EGYPT                     |   1992 | 472456085.965845
 ETHIOPIA                  |   1998 |  270156325.86754
 ETHIOPIA                  |   1997 | 455281791.079892
 ETHIOPIA                  |   1996 |  458090827.37202
 ETHIOPIA                  |   1995 | 458262847.630422
 ETHIOPIA                  |   1994 | 461038409.548571
 ETHIOPIA                  |   1993 | 456033285.506509
 ETHIOPIA                  |   1992 | 457567989.636947
 FRANCE                    |   1998 | 267836084.797471
 FRANCE                    |   1997 | 449989431.666725
 FRANCE                    |   1996 | 453393908.316894
 FRANCE                    |   1995 | 457338032.485219
 FRANCE                    |   1994 | 461059451.414435
 FRANCE                    |   1993 | 460660821.413137
 FRANCE                    |   1992 | 452573323.702082
 GERMANY                   |   1998 | 277297115.854756
 GERMANY                   |   1997 | 476015715.428743
 GERMANY                   |   1996 | 478692905.914786
 GERMANY                   |   1995 | 475956970.902479
 GERMANY                   |   1994 | 477632209.623865
 GERMANY                   |   1993 | 468396589.364834
 GERMANY                   |   1992 | 471279726.192785
 INDIA                     |   1998 |  277416781.22756
 INDIA                     |   1997 |  468374475.44938
 INDIA                     |   1996 | 475752519.300122
 INDIA                     |   1995 | 473527847.509151
 INDIA                     |   1994 | 473351289.323312
 INDIA                     |   1993 | 475025470.847313
 INDIA                     |   1992 | 478545424.998232
 INDONESIA                 |   1998 | 274304003.989092
 INDONESIA                 |   1997 | 463794461.849029
 INDONESIA                 |   1996 | 464454469.530797
 INDONESIA                 |   1995 | 463637567.214155
 INDONESIA                 |   1994 | 463756462.209803
 INDONESIA                 |   1993 | 464807897.287375
 INDONESIA                 |   1992 | 460795233.930883
 IRAN                      |   1998 | 273192084.469121
 IRAN                      |   1997 |   475441573.5043
 IRAN                      |   1996 |  473201611.11315
 IRAN                      |   1995 | 472254744.543255
 IRAN                      |   1994 | 476564244.371732
 IRAN                      |   1993 | 474034456.830652
 IRAN                      |   1992 | 478009866.565338
 IRAQ                      |   1998 | 281198042.460238
 IRAQ                      |   1997 | 474431212.323163
 IRAQ                      |   1996 | 482058789.219652
 IRAQ                      |   1995 | 471845160.186202
 IRAQ                      |   1994 | 481345452.537587
 IRAQ                      |   1993 | 472943104.430382
 IRAQ                      |   1992 | 476326586.897087
 JAPAN                     |   1998 | 278334771.665601
 JAPAN                     |   1997 | 462040478.073648
 JAPAN                     |   1996 | 459262836.305959
 JAPAN                     |   1995 | 466103541.862117
 JAPAN                     |   1994 | 463151068.258729
 JAPAN                     |   1993 |  463795012.43361
 JAPAN                     |   1992 | 466783430.927883
 JORDAN                    |   1998 | 268276415.141957
 JORDAN                    |   1997 | 462063932.073498
 JORDAN                    |   1996 | 466717907.358599
 JORDAN                    |   1995 | 457729820.188934
 JORDAN                    |   1994 | 462472266.599602
 JORDAN                    |   1993 | 452136531.387999
 JORDAN                    |   1992 | 468138786.723056
 KENYA                     |   1998 | 269355294.004135
 KENYA                     |   1997 | 464402694.599245
 KENYA                     |   1996 | 468096834.326631
 KENYA                     |   1995 | 467077184.801527
 KENYA                     |   1994 | 475517511.938547
 KENYA                     |   1993 |  474267783.91194
 KENYA                     |   1992 | 462090055.825896
 MOROCCO                   |   1998 |  278566409.98033
 MOROCCO                   |   1997 | 472368923.008188
 MOROCCO                   |   1996 | 472594241.401829
 MOROCCO                   |   1995 | 467295869.177322
 MOROCCO                   |   1994 | 465899124.771342
 MOROCCO                   |   1993 | 480837180.814216
 MOROCCO                   |   1992 |  471072776.62875
 MOZAMBIQUE                |   1998 | 268972099.537077
 MOZAMBIQUE                |   1997 | 457820870.779914
 MOZAMBIQUE                |   1996 | 463268427.178707
 MOZAMBIQUE                |   1995 | 457936193.821048
 MOZAMBIQUE                |   1994 | 459879594.736405
 MOZAMBIQUE                |   1993 | 459744771.131424
 MOZAMBIQUE                |   1992 | 463372608.008807
 PERU                      |   1998 | 274236889.541028
 PERU                      |   1997 |  458947969.10367
 PERU                      |   1996 | 458137709.734999
 PERU                      |   1995 | 463613435.078863
 PERU                      |   1994 | 457172780.191869
 PERU                      |   1993 | 457965635.826653
 PERU                      |   1992 | 455160980.445817
 ROMANIA                   |   1998 | 272208841.277183
 ROMANIA                   |   1997 | 467167303.124602
 ROMANIA                   |   1996 | 467274076.549507
 ROMANIA                   |   1995 |  470701030.25112
 ROMANIA                   |   1994 | 459164958.026502
 ROMANIA                   |   1993 | 466367445.970583
 ROMANIA                   |   1992 | 473826067.102787
 RUSSIA                    |   1998 | 281815428.514679
 RUSSIA                    |   1997 | 484320966.198322
 RUSSIA                    |   1996 | 478431707.419131
 RUSSIA                    |   1995 | 475217705.630662
 RUSSIA                    |   1994 | 475211753.446646
 RUSSIA                    |   1993 | 473788573.181462
 RUSSIA                    |   1992 | 471535253.551136
 SAUDI ARABIA              |   1998 | 277223010.848756
 SAUDI ARABIA              |   1997 | 471977958.042129
 SAUDI ARABIA              |   1996 | 467097564.673868
 SAUDI ARABIA              |   1995 | 464632999.910099
 SAUDI ARABIA              |   1994 | 470433807.342713
 SAUDI ARABIA              |   1993 | 465369272.181003
 SAUDI ARABIA              |   1992 | 465430054.066301
 UNITED KINGDOM            |   1998 | 267591016.858023
 UNITED KINGDOM            |   1997 | 459872948.544306
 UNITED KINGDOM            |   1996 | 461992807.300779
 UNITED KINGDOM            |   1995 | 460350138.876745
 UNITED KINGDOM            |   1994 | 457958983.041426
 UNITED KINGDOM            |   1993 | 459869029.742428
 UNITED KINGDOM            |   1992 |  462570285.33546
 UNITED STATES             |   1998 | 275166491.575901
 UNITED STATES             |   1997 | 477317340.054659
 UNITED STATES             |   1996 | 474286634.589317
 UNITED STATES             |   1995 |  472106992.75934
 UNITED STATES             |   1994 | 472347000.222716
 UNITED STATES             |   1993 | 476115890.049898
 UNITED STATES             |   1992 | 479389054.708137
 VIETNAM                   |   1998 |  269540726.24833
 VIETNAM                   |   1997 | 464272979.106245
 VIETNAM                   |   1996 | 459049625.436106
 VIETNAM                   |   1995 |  464193583.20982
 VIETNAM                   |   1994 | 460412320.217504
 VIETNAM                   |   1993 | 456715065.342953
 VIETNAM                   |   1992 | 452633904.658047
(175 rows)

COMMIT;
COMMIT
