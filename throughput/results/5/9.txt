BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%lace%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 263839398.499715
 ALGERIA                   |   1997 | 452392124.196726
 ALGERIA                   |   1996 | 451595461.729542
 ALGERIA                   |   1995 | 453631362.688672
 ALGERIA                   |   1994 | 457845481.115816
 ALGERIA                   |   1993 | 454665714.709708
 ALGERIA                   |   1992 | 450641871.604998
 ARGENTINA                 |   1998 | 268187179.631924
 ARGENTINA                 |   1997 |  460927611.48592
 ARGENTINA                 |   1996 | 461176002.261842
 ARGENTINA                 |   1995 | 455503059.690151
 ARGENTINA                 |   1994 | 459807881.387849
 ARGENTINA                 |   1993 | 461915622.379876
 ARGENTINA                 |   1992 | 460607444.749428
 BRAZIL                    |   1998 |  276626937.23971
 BRAZIL                    |   1997 | 472639544.047593
 BRAZIL                    |   1996 | 476779397.933014
 BRAZIL                    |   1995 | 482061368.875417
 BRAZIL                    |   1994 | 476381221.140219
 BRAZIL                    |   1993 | 472979126.474302
 BRAZIL                    |   1992 | 471549429.158669
 CANADA                    |   1998 | 280317990.588178
 CANADA                    |   1997 | 475495830.022907
 CANADA                    |   1996 | 481522337.000652
 CANADA                    |   1995 | 470926925.055211
 CANADA                    |   1994 | 471515537.749691
 CANADA                    |   1993 | 475759679.117697
 CANADA                    |   1992 | 476862046.279471
 CHINA                     |   1998 | 272548911.311085
 CHINA                     |   1997 | 463320889.569499
 CHINA                     |   1996 | 462870622.552889
 CHINA                     |   1995 |  457719967.87208
 CHINA                     |   1994 | 465003827.922349
 CHINA                     |   1993 | 462983869.680557
 CHINA                     |   1992 | 458756268.445763
 EGYPT                     |   1998 | 275847109.063691
 EGYPT                     |   1997 | 464210127.339785
 EGYPT                     |   1996 | 461738426.163079
 EGYPT                     |   1995 | 462172657.479778
 EGYPT                     |   1994 |  461441246.39793
 EGYPT                     |   1993 | 467719286.238907
 EGYPT                     |   1992 | 468520697.820509
 ETHIOPIA                  |   1998 | 271869546.616385
 ETHIOPIA                  |   1997 | 466590555.758604
 ETHIOPIA                  |   1996 | 462864672.575512
 ETHIOPIA                  |   1995 | 468617616.213333
 ETHIOPIA                  |   1994 | 473062888.778914
 ETHIOPIA                  |   1993 | 469028968.528768
 ETHIOPIA                  |   1992 | 463478631.717973
 FRANCE                    |   1998 | 262982092.336123
 FRANCE                    |   1997 | 453722875.787535
 FRANCE                    |   1996 | 454605330.937293
 FRANCE                    |   1995 | 462026235.511289
 FRANCE                    |   1994 | 458315805.146096
 FRANCE                    |   1993 |  456440374.38651
 FRANCE                    |   1992 | 453754919.503566
 GERMANY                   |   1998 | 274169932.335585
 GERMANY                   |   1997 | 465039973.943353
 GERMANY                   |   1996 | 466856135.839339
 GERMANY                   |   1995 | 473897317.731134
 GERMANY                   |   1994 | 472125156.966509
 GERMANY                   |   1993 | 473529758.542094
 GERMANY                   |   1992 | 467868192.090769
 INDIA                     |   1998 | 284864470.813658
 INDIA                     |   1997 | 475228464.310664
 INDIA                     |   1996 | 483156615.264308
 INDIA                     |   1995 | 479894403.558606
 INDIA                     |   1994 | 474248050.063713
 INDIA                     |   1993 | 480857462.389692
 INDIA                     |   1992 | 478158142.920345
 INDONESIA                 |   1998 | 270728397.028464
 INDONESIA                 |   1997 |   472403562.9365
 INDONESIA                 |   1996 | 467309064.205337
 INDONESIA                 |   1995 | 464167484.297382
 INDONESIA                 |   1994 |  473320202.71818
 INDONESIA                 |   1993 | 467332544.255033
 INDONESIA                 |   1992 |  467518319.46196
 IRAN                      |   1998 | 269588910.342483
 IRAN                      |   1997 | 467321897.939314
 IRAN                      |   1996 | 459620880.384986
 IRAN                      |   1995 | 466136252.033504
 IRAN                      |   1994 | 457256839.724098
 IRAN                      |   1993 | 462178871.343044
 IRAN                      |   1992 |   467292677.9944
 IRAQ                      |   1998 | 272357610.172558
 IRAQ                      |   1997 |  470352951.02419
 IRAQ                      |   1996 | 467354071.147052
 IRAQ                      |   1995 | 468857688.358503
 IRAQ                      |   1994 | 477727961.975218
 IRAQ                      |   1993 | 462297082.399263
 IRAQ                      |   1992 | 466890987.119017
 JAPAN                     |   1998 | 275231016.007477
 JAPAN                     |   1997 | 466293060.572748
 JAPAN                     |   1996 | 466989380.813812
 JAPAN                     |   1995 |  474593993.19469
 JAPAN                     |   1994 | 459146740.459621
 JAPAN                     |   1993 | 470150454.996932
 JAPAN                     |   1992 | 472990113.043754
 JORDAN                    |   1998 | 270028745.545683
 JORDAN                    |   1997 | 459548856.384447
 JORDAN                    |   1996 | 462409408.393662
 JORDAN                    |   1995 | 462160643.420376
 JORDAN                    |   1994 | 465498579.942837
 JORDAN                    |   1993 | 467181352.195783
 JORDAN                    |   1992 | 463042223.573548
 KENYA                     |   1998 | 278295861.750424
 KENYA                     |   1997 | 473856520.961881
 KENYA                     |   1996 | 470457234.344766
 KENYA                     |   1995 | 468869529.373683
 KENYA                     |   1994 | 473662179.214204
 KENYA                     |   1993 | 473935106.036014
 KENYA                     |   1992 | 485352385.794392
 MOROCCO                   |   1998 | 272833710.414973
 MOROCCO                   |   1997 | 476696947.970128
 MOROCCO                   |   1996 | 466951905.257855
 MOROCCO                   |   1995 | 461177168.518922
 MOROCCO                   |   1994 | 468586635.359738
 MOROCCO                   |   1993 | 468818200.847999
 MOROCCO                   |   1992 |  465303171.77151
 MOZAMBIQUE                |   1998 | 267504174.212413
 MOZAMBIQUE                |   1997 | 460963567.306394
 MOZAMBIQUE                |   1996 | 464939114.230082
 MOZAMBIQUE                |   1995 | 454070036.918305
 MOZAMBIQUE                |   1994 | 457099534.589174
 MOZAMBIQUE                |   1993 | 456299216.767974
 MOZAMBIQUE                |   1992 | 449718711.965789
 PERU                      |   1998 |  269987477.90634
 PERU                      |   1997 | 459557031.600908
 PERU                      |   1996 | 470370994.585842
 PERU                      |   1995 |  463643025.13742
 PERU                      |   1994 | 459025290.031412
 PERU                      |   1993 | 467370920.166514
 PERU                      |   1992 | 466546432.897181
 ROMANIA                   |   1998 | 271891758.311129
 ROMANIA                   |   1997 | 464041576.057537
 ROMANIA                   |   1996 | 473800390.436498
 ROMANIA                   |   1995 | 467554388.189933
 ROMANIA                   |   1994 | 473593695.136024
 ROMANIA                   |   1993 | 474658851.532801
 ROMANIA                   |   1992 | 469633696.442734
 RUSSIA                    |   1998 | 275238095.952897
 RUSSIA                    |   1997 | 471594565.942677
 RUSSIA                    |   1996 | 473733465.381251
 RUSSIA                    |   1995 | 462835537.881368
 RUSSIA                    |   1994 |  470287319.25922
 RUSSIA                    |   1993 | 463974346.596614
 RUSSIA                    |   1992 | 474130606.378834
 SAUDI ARABIA              |   1998 |  272691627.98788
 SAUDI ARABIA              |   1997 | 467710117.626549
 SAUDI ARABIA              |   1996 | 466659176.695677
 SAUDI ARABIA              |   1995 | 468848373.196364
 SAUDI ARABIA              |   1994 | 466700733.537901
 SAUDI ARABIA              |   1993 | 468502185.705455
 SAUDI ARABIA              |   1992 | 469260421.321662
 UNITED KINGDOM            |   1998 |  278244432.99675
 UNITED KINGDOM            |   1997 | 464842242.784214
 UNITED KINGDOM            |   1996 | 465222973.672802
 UNITED KINGDOM            |   1995 | 465293127.865803
 UNITED KINGDOM            |   1994 | 472906176.158996
 UNITED KINGDOM            |   1993 | 462013193.325801
 UNITED KINGDOM            |   1992 | 454036452.657459
 UNITED STATES             |   1998 | 262832988.087361
 UNITED STATES             |   1997 | 459954672.060317
 UNITED STATES             |   1996 | 465225608.616271
 UNITED STATES             |   1995 | 458180861.597478
 UNITED STATES             |   1994 |  458296522.58999
 UNITED STATES             |   1993 | 463857606.433083
 UNITED STATES             |   1992 | 454378628.491582
 VIETNAM                   |   1998 | 271504909.235093
 VIETNAM                   |   1997 | 465191579.915409
 VIETNAM                   |   1996 |  477650924.82491
 VIETNAM                   |   1995 | 469465881.014576
 VIETNAM                   |   1994 | 464207760.795718
 VIETNAM                   |   1993 | 468737411.793936
 VIETNAM                   |   1992 | 470315389.530482
(175 rows)

COMMIT;
COMMIT
