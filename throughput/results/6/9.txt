BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%grey%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  265838781.31837
 ALGERIA                   |   1997 | 452466357.487792
 ALGERIA                   |   1996 | 454132069.337718
 ALGERIA                   |   1995 | 458516451.826455
 ALGERIA                   |   1994 | 454641908.167126
 ALGERIA                   |   1993 | 454092566.166037
 ALGERIA                   |   1992 | 453011844.093048
 ARGENTINA                 |   1998 | 274368024.665168
 ARGENTINA                 |   1997 | 475706061.008576
 ARGENTINA                 |   1996 | 472708490.783953
 ARGENTINA                 |   1995 | 461308992.785306
 ARGENTINA                 |   1994 | 463088944.368518
 ARGENTINA                 |   1993 | 465010902.369247
 ARGENTINA                 |   1992 | 464057840.256054
 BRAZIL                    |   1998 | 275084634.686399
 BRAZIL                    |   1997 |  466870093.54365
 BRAZIL                    |   1996 | 465356847.341004
 BRAZIL                    |   1995 | 464761341.865567
 BRAZIL                    |   1994 | 462222118.474357
 BRAZIL                    |   1993 | 465144763.395933
 BRAZIL                    |   1992 |  474588701.31899
 CANADA                    |   1998 | 272845726.664591
 CANADA                    |   1997 | 478976876.266936
 CANADA                    |   1996 | 475551096.905827
 CANADA                    |   1995 |  470207404.62025
 CANADA                    |   1994 | 485337982.205227
 CANADA                    |   1993 |  470504870.66351
 CANADA                    |   1992 | 472095289.382182
 CHINA                     |   1998 |  272333574.30667
 CHINA                     |   1997 | 469886247.379691
 CHINA                     |   1996 | 465800549.681691
 CHINA                     |   1995 | 464772983.496773
 CHINA                     |   1994 | 463556751.488928
 CHINA                     |   1993 | 465988314.194039
 CHINA                     |   1992 | 473761039.275277
 EGYPT                     |   1998 | 276885445.357019
 EGYPT                     |   1997 | 464248758.444706
 EGYPT                     |   1996 | 469973456.448878
 EGYPT                     |   1995 |  455630725.00268
 EGYPT                     |   1994 | 456679142.369919
 EGYPT                     |   1993 | 460878824.077188
 EGYPT                     |   1992 | 459442166.751847
 ETHIOPIA                  |   1998 | 270468480.719767
 ETHIOPIA                  |   1997 | 456379147.102576
 ETHIOPIA                  |   1996 | 458133680.954055
 ETHIOPIA                  |   1995 | 460565416.278501
 ETHIOPIA                  |   1994 | 465579628.142453
 ETHIOPIA                  |   1993 | 461437647.305868
 ETHIOPIA                  |   1992 | 463308194.505241
 FRANCE                    |   1998 | 268364832.184617
 FRANCE                    |   1997 | 457334395.295155
 FRANCE                    |   1996 | 461153481.574271
 FRANCE                    |   1995 |  460126513.58135
 FRANCE                    |   1994 | 456320310.982086
 FRANCE                    |   1993 | 450167841.652556
 FRANCE                    |   1992 | 457809211.473403
 GERMANY                   |   1998 | 283095810.545516
 GERMANY                   |   1997 | 480910171.619672
 GERMANY                   |   1996 | 473028822.729804
 GERMANY                   |   1995 | 483409125.019741
 GERMANY                   |   1994 | 482351558.883377
 GERMANY                   |   1993 | 475630156.654757
 GERMANY                   |   1992 | 470048259.131873
 INDIA                     |   1998 | 274699328.768241
 INDIA                     |   1997 | 480686664.989833
 INDIA                     |   1996 | 477237251.959658
 INDIA                     |   1995 | 468222086.438803
 INDIA                     |   1994 | 481126990.509208
 INDIA                     |   1993 |  471589868.37318
 INDIA                     |   1992 | 475805239.981544
 INDONESIA                 |   1998 | 276992148.689475
 INDONESIA                 |   1997 |  462667573.79458
 INDONESIA                 |   1996 |  461860172.67213
 INDONESIA                 |   1995 |  465984691.11632
 INDONESIA                 |   1994 | 465975623.904466
 INDONESIA                 |   1993 | 468211762.782328
 INDONESIA                 |   1992 |  466378479.99174
 IRAN                      |   1998 | 275489102.897647
 IRAN                      |   1997 | 462132591.531585
 IRAN                      |   1996 | 454080355.934476
 IRAN                      |   1995 | 457438293.060632
 IRAN                      |   1994 | 452926274.114343
 IRAN                      |   1993 | 458626200.110257
 IRAN                      |   1992 | 453258623.273925
 IRAQ                      |   1998 | 278078861.920525
 IRAQ                      |   1997 | 467651358.273411
 IRAQ                      |   1996 |  469702570.61041
 IRAQ                      |   1995 | 466787888.824048
 IRAQ                      |   1994 | 475978990.445077
 IRAQ                      |   1993 | 463701739.490116
 IRAQ                      |   1992 | 474177749.261789
 JAPAN                     |   1998 | 270863868.962057
 JAPAN                     |   1997 | 472516326.770434
 JAPAN                     |   1996 | 460870032.769373
 JAPAN                     |   1995 | 465174943.873318
 JAPAN                     |   1994 | 460109538.731753
 JAPAN                     |   1993 | 463532451.993245
 JAPAN                     |   1992 | 465904498.525406
 JORDAN                    |   1998 | 274077636.513936
 JORDAN                    |   1997 | 464765466.599068
 JORDAN                    |   1996 | 467558688.276867
 JORDAN                    |   1995 |  463238807.21343
 JORDAN                    |   1994 | 459229130.410081
 JORDAN                    |   1993 | 460412292.758284
 JORDAN                    |   1992 | 465004360.490619
 KENYA                     |   1998 | 275144786.921296
 KENYA                     |   1997 | 484078352.929558
 KENYA                     |   1996 | 485856210.206047
 KENYA                     |   1995 | 469944286.830903
 KENYA                     |   1994 | 473056702.104506
 KENYA                     |   1993 | 468907713.313641
 KENYA                     |   1992 | 475151247.656062
 MOROCCO                   |   1998 | 277921138.703388
 MOROCCO                   |   1997 | 470049771.245112
 MOROCCO                   |   1996 | 468300768.903995
 MOROCCO                   |   1995 | 471013350.546919
 MOROCCO                   |   1994 | 466051864.632497
 MOROCCO                   |   1993 | 465556556.793212
 MOROCCO                   |   1992 | 473448349.101193
 MOZAMBIQUE                |   1998 | 268747410.631332
 MOZAMBIQUE                |   1997 | 461575290.468682
 MOZAMBIQUE                |   1996 |  462071374.68732
 MOZAMBIQUE                |   1995 | 458088209.957218
 MOZAMBIQUE                |   1994 | 463005364.550332
 MOZAMBIQUE                |   1993 | 467270220.884213
 MOZAMBIQUE                |   1992 | 468274408.462985
 PERU                      |   1998 | 276448992.359427
 PERU                      |   1997 | 462701870.914051
 PERU                      |   1996 | 462301306.549005
 PERU                      |   1995 | 452761777.976199
 PERU                      |   1994 |  458061894.05963
 PERU                      |   1993 | 455856801.956325
 PERU                      |   1992 |  456456442.67094
 ROMANIA                   |   1998 | 274923324.118236
 ROMANIA                   |   1997 | 465107299.274011
 ROMANIA                   |   1996 | 465728242.671124
 ROMANIA                   |   1995 | 467384201.435792
 ROMANIA                   |   1994 |  468663834.51485
 ROMANIA                   |   1993 | 461891100.437512
 ROMANIA                   |   1992 | 466498599.746626
 RUSSIA                    |   1998 | 274219586.776563
 RUSSIA                    |   1997 | 465082203.699829
 RUSSIA                    |   1996 | 474712141.983994
 RUSSIA                    |   1995 | 471644304.974874
 RUSSIA                    |   1994 | 472894062.520896
 RUSSIA                    |   1993 | 465633214.149016
 RUSSIA                    |   1992 | 469945300.416442
 SAUDI ARABIA              |   1998 | 278076780.484677
 SAUDI ARABIA              |   1997 | 468954858.322729
 SAUDI ARABIA              |   1996 | 465576983.672562
 SAUDI ARABIA              |   1995 | 467938502.424493
 SAUDI ARABIA              |   1994 | 468168645.337479
 SAUDI ARABIA              |   1993 | 466737859.417238
 SAUDI ARABIA              |   1992 | 468051438.010351
 UNITED KINGDOM            |   1998 | 273008594.621902
 UNITED KINGDOM            |   1997 | 460281922.384704
 UNITED KINGDOM            |   1996 | 460329373.917712
 UNITED KINGDOM            |   1995 | 459399808.589347
 UNITED KINGDOM            |   1994 | 459698362.804816
 UNITED KINGDOM            |   1993 | 461275728.847726
 UNITED KINGDOM            |   1992 | 455592627.983072
 UNITED STATES             |   1998 | 272603110.983223
 UNITED STATES             |   1997 | 476363551.788608
 UNITED STATES             |   1996 | 471599642.979403
 UNITED STATES             |   1995 | 465108065.960283
 UNITED STATES             |   1994 |  470348857.49396
 UNITED STATES             |   1993 | 471831608.576005
 UNITED STATES             |   1992 | 470993189.075123
 VIETNAM                   |   1998 | 269507380.683053
 VIETNAM                   |   1997 | 462394629.233663
 VIETNAM                   |   1996 | 462891408.535496
 VIETNAM                   |   1995 | 459296226.700408
 VIETNAM                   |   1994 | 463102844.845284
 VIETNAM                   |   1993 | 467035924.466071
 VIETNAM                   |   1992 |   461105302.1177
(175 rows)

COMMIT;
COMMIT
